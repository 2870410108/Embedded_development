C51 COMPILER V9.56.0.0   SNAK_GAME                                                         07/04/2024 20:22:23 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE SNAK_GAME
OBJECT MODULE PLACED IN .\Objects\snak_game.obj
COMPILER INVOKED BY: C:\dev\keil\C51\BIN\C51.EXE snak_game.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listing
                    -s\snak_game.lst) TABS(2) OBJECT(.\Objects\snak_game.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "tools/oled12864.h"
   3          #include "tools/delay_ms.h"
   4          #include "tools/init_timer.h"
   5          #define u8 unsigned char
   6          #define u32 unsigned int
   7          
   8          
   9          //æŒ‰é”®å®šä¹‰
  10          sbit  up   =P1^2;
  11          sbit  down =P1^4;
  12          sbit  left =P1^5;
  13          sbit  right=P1^3;
  14          //æ‰“å°è›‡ä¸€ä¸ªèŠ‚ç‚¹æ‰€éœ€è¦çš„åƒç´ ç‚¹8*8
  15          const u8 code food[8]={0xFF,0xFF,0xC3,0xC3,0xC3,0xC3,0xFF,0xFF};
  16          const u8 code blank[8]={0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
  17          const u8 code body[8]={0x00,0x7E,0x7E,0x7E,0x7E,0x7E,0x7E,0x00};
  18          //ç”¨äºå‚¨å­˜è›‡èŠ‚ç‚¹çš„ä½ç½®
  19          u8 snake_x[30],snake_y[30];
  20          //é£Ÿç‰©çš„åæ ‡ä½ç½®
  21          u8 food_x,food_y;
  22          //è›‡çš„é•¿åº¦
  23          u8 snake_lenght;
  24          //è›‡çš„æ–¹å‘
  25          u8 dir;
  26          //å®šæ—¶å™¨é‡è£…åˆå§‹å€¼;
  27          u32 num;
  28          //å®šæ—¶å™¨è®¡æ•°
  29          u8 count;
  30          //æ¸¸æˆåˆ†æ•°
  31          u8 score;
  32          //æ‰“å°è›‡
  33          void print_OLED_SnakeBody()
  34          {
  35   1         u8 i;
  36   1         for(i=0;i<snake_lenght;i++)
  37   1         {
  38   2            OLED_showImage(snake_y[i], snake_x[i]*8,8,8,body);
  39   2         }
  40   1       }
  41          
  42          //åˆå§‹åŒ–æ¸¸æˆ
  43          void init_game()
  44          {
  45   1        
  46   1        
  47   1        dir=1;//åˆå§‹åŒ–æ–¹å‘
  48   1        snake_lenght=3;//åˆå§‹åŒ–è›‡çš„é•¿åº¦
  49   1        food_x=6;food_y=6;//åˆå§‹åŒ–é£Ÿç‰©
  50   1        snake_x[0]=5,snake_y[0]=3;//åˆå§‹åŒ–è›‡å¤´ä½ç½®
  51   1        snake_x[1]=4,snake_y[1]=3;//åˆå§‹åŒ–ç¬¬äºŒèŠ‚ç‚¹
  52   1        snake_x[2]=3,snake_y[2]=3;//åˆå§‹åŒ–ç¬¬ä¸‰èŠ‚ç‚¹
  53   1        OLED_Init();//åˆå§‹åŒ–OLED
  54   1        OLED_showImage_128X64();//æ¬¢è¿ç•Œé¢
C51 COMPILER V9.56.0.0   SNAK_GAME                                                         07/04/2024 20:22:23 PAGE 2   

  55   1        delay_ms(1000);
  56   1        OLED_Clear();//æ¸…å±
  57   1        print_OLED_SnakeBody();//ç”»å‡ºè›‡èº«
  58   1        OLED_showImage(food_y, food_x*8,8,8,food);//æ‰“å°é£Ÿç‰©
  59   1        num=init_timer(0,1,50000,12,1);//åˆå§‹åŒ–å®šæ—¶å™¨0ï¼Œæ–¹å¼ä¸€
  60   1      }
  61          //æŒ‰é”®æ£€æµ‹
  62          void key_check()
  63          { 
  64   1        if(!up||!down||!left||!right)
  65   1          {
  66   2            if(!up){
  67   3              delay_ms(10);
  68   3              if(!up)
  69   3                while(!up);
  70   3              if(dir!=2){//æ£€æµ‹å½“å‰æ–¹å‘æ˜¯å¦ä¸é¢„è®¡ä¿®æ”¹çš„æ–¹å‘å†²çª
  71   4                  dir=1;return;
  72   4                }
  73   3            }
  74   2            if(!down){
  75   3              delay_ms(10);
  76   3              if(!down)
  77   3                while(!down);
  78   3                if(dir!=1){
  79   4                  dir=2;return;
  80   4                }
  81   3            }
  82   2            if(!left){
  83   3              delay_ms(10);
  84   3              if(!left)
  85   3                while(!left);
  86   3                if(dir!=4){
  87   4                  dir=3;return;
  88   4                }
  89   3            }
  90   2            if(!right){
  91   3              delay_ms(20);
  92   3              if(!right)
  93   3                while(!right);
  94   3                if(dir!=3){
  95   4                  dir=4;return;
  96   4                }
  97   3            }
  98   2          }
  99   1      }
 100          //é£Ÿç‰©æ£€æµ‹
 101          void Food_check()
 102          {
 103   1          if ((dir == 1 && snake_x[0] == food_x && snake_y[0] - 1 == food_y) ||
 104   1              (dir == 2 && snake_x[0] == food_x && snake_y[0] + 1 == food_y) ||
 105   1              (dir == 3 && snake_x[0] - 1 == food_x && snake_y[0] == food_y) ||
 106   1              (dir == 4 && snake_x[0] + 1 == food_x && snake_y[0] == food_y))
 107   1          {   
 108   2              // æ¸…é™¤é£Ÿç‰©
 109   2              OLED_showImage(food_y,food_x* 8, 8, 8, blank);
 110   2              food_x = rand() % 8;
*** WARNING C206 IN LINE 110 OF snak_game.c: 'rand': missing function-prototype
 111   2              food_y = rand() % 16;
 112   2              snake_lenght++;
 113   2              score++;
 114   2            // ç”Ÿæˆæ–°é£Ÿç‰©
 115   2              OLED_showImage(food_y,food_x* 8, 8, 8, food);
C51 COMPILER V9.56.0.0   SNAK_GAME                                                         07/04/2024 20:22:23 PAGE 3   

 116   2          }
 117   1      }
 118          //è›‡çš„ç§»åŠ¨æ ¸å¿ƒæ€è·¯åˆ†æ
 119          /*
 120          ä½¿ç”¨æ•°ç»„å­˜å‚¨è›‡çš„èŠ‚ç‚¹åæ ‡ï¼Œè›‡å¤´åœ¨æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ 
 121          ç§»åŠ¨æ—¶åªéœ€è¦æ”¹å˜è›‡å¤´åæ ‡å³å¯ï¼Œç„¶åè›‡å°¾æ¯ä¸€èŠ‚ä¸€æ¬¡ç­‰äºå‰ä¸€ä¸ªè›‡èŠ‚ç‚¹ä½ç½®å³å
             -¯
 122          è¿˜éœ€è¦è€ƒè™‘æ­¤æ—¶è›‡çš„æ–¹å‘ï¼Œæ ¹æ®æ–¹å‘æ”¹å˜ç›¸åº”åæ ‡
 123          åŠ ruæ­¤åˆ»åœ¨å‘ä¸Šç§»åŠ¨ï¼Œé‚£å°±éœ€è¦æ›´æ–°Yåæ ‡
 124          //4 5 6-->3 4 5   Y
 125          //5 5 5-->5 5 5   X
 126          */
 127          void move(){
 128   1          u8 i;
 129   1      
 130   1          // æ¸…é™¤è›‡å°¾çš„å‰ä¸€ä¸ªä½ç½®
 131   1          OLED_showImage(snake_y[snake_lenght-1], snake_x[snake_lenght-1] * 8, 8, 8, blank);
 132   1      
 133   1          // æ›´æ–°è›‡çš„æ¯ä¸€èŠ‚çš„ä½ç½®
 134   1          for(i = snake_lenght - 1; i > 0; i--){
 135   2              snake_x[i] = snake_x[i - 1];
 136   2              snake_y[i] = snake_y[i - 1];
 137   2          }
 138   1      
 139   1          // æ›´æ–°è›‡å¤´çš„ä½ç½®
 140   1          switch(dir){
 141   2              case 1: snake_y[0]--; break;
 142   2              case 2: snake_y[0]++; break;
 143   2              case 3: snake_x[0]--; break;
 144   2              case 4: snake_x[0]++; break;
 145   2          }
 146   1      
 147   1          print_OLED_SnakeBody(); // é‡æ–°ç»˜åˆ¶æ•´æ¡è›‡
 148   1      }
 149          //åˆ¤æ–­è›‡æ˜¯å¦æ­»äº¡
 150          bit isDeath()
 151          {
 152   1          u8 i;
 153   1          if (snake_x[0] == -1 || snake_y[0] == -1 || snake_x[0] == 16 || snake_y[0] == 8)
 154   1            // è›‡å¤´åœ¨è¾¹ç•Œæˆ–å¢™å£ä¸Š
 155   1              return 1;
 156   1          for (i = 1; i < snake_lenght; ++i)
 157   1              if (snake_x[0] == snake_x[i] && snake_y[0] == snake_y[i])
 158   1                // è›‡å¤´ä¸èº«ä½“é‡åˆ
 159   1                  return 1;
 160   1          return 0;
 161   1      }
 162          void MainLoop() {
 163   1          key_check();
 164   1          if (count >= 10) {
 165   2              count = 0;
 166   2              if (isDeath()) {
 167   3                  
 168   3                OLED_Clear();//æ¸…å±
 169   3                OLED_showString(0, 13,"GAME OVER !!!",1);
 170   3                OLED_showString(2, 13,"SCORE --> ",1);
 171   3                OLED_showString(2, 13,"SCORE --> ",1);
 172   3              } else {
 173   3                  Food_check();
 174   3                  move();
 175   3              }
 176   2          }
C51 COMPILER V9.56.0.0   SNAK_GAME                                                         07/04/2024 20:22:23 PAGE 4   

 177   1      }
 178          void T0_interrupt () interrupt 1{
 179   1        TH0=num/256;
 180   1        TL0=num%256;
 181   1        if(count>=10)
 182   1          count=0;
 183   1        count++;
 184   1      }
 185          
 186          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    702    ----
   CONSTANT SIZE    =     49    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     68       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
